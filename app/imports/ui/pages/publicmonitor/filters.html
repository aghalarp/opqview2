<template name="filters">
  <!-- Filters Panel -->
  <div class="row">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">
          <i class="fa fa-sliders" style="margin-right: 5px;"></i>Filters
          <button style="margin-top: -7px;" type="button" class="btn btn-default btn-sm pull-right" data-toggle="modal" data-target="#displayModal">
            <i class="fa fa-question-circle fa-lg"></i>
          </button>
        </h3>
      </div>
      <div class="panel-body">

        {{#if Template.subscriptionsReady}}
          {{#autoForm schema=filtersSchema template="bootstrap3" id="filterForm" type="normal" resetOnSuccess=false templateInstance=getTemplateInstance}}
            {{#let prefill=prefillFilters}}
            <!-- Frequency filter -->
            <div class="row">
              <label class="col-sm-3">Freq. (Hz)</label>
              {{> afFormGroup name="requestFreq" type="boolean-checkbox" value=prefill.requestFreq defaultValue=true formgroup-class="col-xs-1"}}
              {{> afFormGroup name="minFreq" type="text" defaultValue=(formatDecimals prefill.minFreq) formgroup-class="col-sm-4" label-class="sr-only" placeholder="Min Frequency"}}
              {{> afFormGroup name="maxFreq" type="text" defaultValue=(formatDecimals prefill.maxFreq) formgroup-class="col-sm-4" label-class="sr-only" placeholder="Max Frequency"}}
            </div>

            <!-- Voltage filter -->
            <div class="row">
              <label class="col-sm-3">Voltage (V)</label>
              {{> afFormGroup name="requestVoltage" type="boolean-checkbox" value=prefill.requestVoltage defaultValue=true formgroup-class="col-xs-1"}}
              {{> afFormGroup name="minVoltage" type="text" defaultValue=(formatDecimals prefill.minVoltage) formgroup-class="col-sm-4" label-class="sr-only" placeholder="Min Voltage"}}
              {{> afFormGroup name="maxVoltage" type="text" defaultValue=(formatDecimals prefill.maxVoltage) formgroup-class="col-sm-4" label-class="sr-only" placeholder="Max Voltage"}}
            </div>

            <!-- Duration filter -->
            <div class="row">
              <label class="col-sm-4">Duration (sec)</label>
              {{> afFormGroup name="minDuration" type="text" defaultValue=prefill.minDuration formgroup-class="col-sm-4" label-class="sr-only" placeholder="Min Duration"}}
              {{> afFormGroup name="maxDuration" type="text" defaultValue=prefill.maxDuration formgroup-class="col-sm-4" label-class="sr-only" placeholder="Max Duration"}}
            </div>


            <!-- ITIC filter -->
            <div class="row">
              {{> afFormGroup name="itic" template="bootstrap3-inline" type="select-checkbox-inline" label-class="col-sm-4" value=prefill.itic label="ITIC"}}
            </div>


            <!-- Time interval filter -->
            <div class="row">
              <label class="col-sm-2 control-label">Time Interval</label>

              <!-- Start time interval -->
              <div class="form-group col-sm-5 {{#if afFieldIsInvalid name='startTime'}} has-error {{/if}}">
                <div id="startTime" class="input-group date">
                  {{> afFieldInput name="startTime" type="text" defaultValue=""}}
                    <span class="input-group-addon">
                      <i class="glyphicon glyphicon-calendar"></i>
                    </span>
                </div>
                <span class="help-block">{{afFieldMessage name="startTime"}}</span>
              </div>

              <!-- Stop time interval -->
              <div class="form-group col-sm-5 {{#if afFieldIsInvalid name='stopTime'}} has-error {{/if}}">
                <div id="stopTime" class="input-group date">
                  {{> afFieldInput name="stopTime" type="text" defaultValue=itic.startTime}}
                  <span class="input-group-addon">
                      <i class="glyphicon glyphicon-calendar"></i>
                    </span>
                </div>
                <span class="help-block">{{afFieldMessage name="stopTime"}}</span>
              </div>
            </div>
            {{/let}}

          <!-- ITIC filter -->
          <!--<div class="row">-->
            <!--<label class="col-sm-4 control-label">ITIC</label>-->
            <!--<label class="col-xs-2 control-label">Severe</label>-->
            <!--<div class="col-xs-1">-->
              <!--<input type="checkbox" id="requestIticSevere">-->
            <!--</div>-->
            <!--<label class="col-xs-2 control-label">Moderate</label>-->
            <!--<div class="col-xs-1">-->
              <!--<input type="checkbox" id="requestIticModerate">-->
            <!--</div>-->
            <!--<label class="col-xs-1 control-label">OK</label>-->
            <!--<div class="col-xs-1">-->
              <!--<input type="checkbox" id="requestIticOk">-->
            <!--</div>-->
          <!--</div>-->


          <!-- Quick Views -->
          <!--<div class="row" style="margin-top: 5px; margin-bottom: 10px;">-->
            <!--<label class="col-sm-4">Quick View</label>-->
            <!--<div class="col-sm-8">-->
              <!--<div class="pull-right">-->
                <!--<button type="submit" class="btn btn-success btn-sm" id="pastDayTimeBtn">Today's Data</button>-->
                <!--<button type="submit" class="btn btn-success btn-sm" id="pastWeekTimeBtn">Week's Data</button>-->
                <!--<button type="submit" class="btn btn-success btn-sm" id="pastMonthTimeBtn">Month's Data</button>-->
              <!--</div>-->
            <!--</div>-->
          <!--</div>-->

          <!-- Update/Reset buttons -->
          <div class="row">
            <label class="col-sm-4">Update</label>
            <div class="col-sm-8">
              <div class="pull-right">
                <button type="submit" class="btn btn-primary btn-md">Update Filters</button>
              </div>
            </div>
          </div>

          {{/autoForm}}

        {{else}}
          {{> loading}}
        {{/if}}
      </div>
      <div id="messages" class="invalid"></div>
    </div>
  </div>

  <!-- Help Modal -->
  <div class="modal fade" id="displayModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Filter Panel</h4>
        </div>
        <div class="modal-body">
          <p>
            The "Filter" pane allows the user to filter the displayed events by a variety of criteria.
          </p>
          <img src="/images/display-panel.png">
          <p>
            The screenshot above illustrates the following event filters:
          <ul>
            <li>Frequencies ranging between 57.96 to 62.42 Hz</li>
            <li>Voltages ranging between 89.3 to 141.1 V</li>
            <li>Event duration ranging between 1 to 256 seconds</li>
            <li>Events falling within all ITIC ranges</li>
            <li>Events occurring between July 31, 2014 through November 30, 2014</li>
          </ul>

          The filter values are pre-populated with default values with minimum and maximum known event frequencies, voltages, and durations, and event ranges.
          </p>
          <p>
            You can can choose to filter out only voltage or frequency events by selecting the appropriated text
            boxes to the right of the "Freq" and "Voltage" labels.
          </p>
          <p>
            You can filter events within certain ranges of frequencies, voltages, and durations by modifying the
            appropriate text fields.
          </p>
          <p>
            You can filter events that meet certain ITIC criteria be selecting the check boxes to the right of the
            "ITIC" field. "Severe" events fall into the "prohibted region" of the ITIC curve. "Moderate" events fall
            into the "no damage region" of the ITIC curve. and "Ok" events fall into the "no damage region" of the
            ITIC curve.
          </p>
          <p>
            You can filter events by date range by selecting the appropriate date ranges to the right of "Time
            Interval".
          </p>
          <p>
            When you are done setting up your filters, press the "Update" button to reload the page with the new
            filter values applied.
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Got it!</button>
        </div>
      </div>
    </div>
  </div>
</template>